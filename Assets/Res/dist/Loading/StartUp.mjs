import { StateFsm } from "Common/StateFsm.mjs";
import { 下载更新 } from "Loading/StartUp/下载更新.mjs";
var Time = CS.UnityEngine.Time;
var Addressables = CS.UnityEngine.AddressableAssets.Addressables;
var $promise = puer.$promise;
var Res = CS.Res;
var GameObject = CS.UnityEngine.GameObject;
var $typeof = puer.$typeof;
var Resources = CS.UnityEngine.Resources;
var Setting = CS.Models.Setting;
var JsMain = CS.App.JsMain;
var UnityApi = CS.UnityApi;
export class StartUp extends StateFsm {
    constructor() {
        super(...arguments);
        this.useRemote = true;
    }
    loadDefault() {
        console.log("Load Backup");
        CS.UnityEngine.Object.Instantiate(Resources.Load("Backup", $typeof(GameObject)));
    }
    async init() {
        this.下载更新 = this.bind(下载更新);
        console.log("init StartUp", `Initial Time: ${Time.realtimeSinceStartup.toFixed(2)}`);
        await $promise(Addressables.InitializeAsync().Task);
        const loc = Res.Exists(this.prefab);
        const resVer = Setting.self.ResVersion.Value;
        const baseVer = JsMain.self.baseVersion;
        const isNew = UnityApi.CompareVersion(resVer, baseVer) > 0; //resVer.localeCompare(baseVer, undefined, {numeric: true, sensitivity: 'base'})
        console.log(`ResVersion: ${resVer} baseVersion: ${baseVer} new: ${isNew}`);
        if (this.useRemote && loc && isNew) {
            console.log("StartContent Found");
            this.prefab.Check(x => {
                console.log("check ok");
            });
            await $promise(this.prefab.Inst(t => {
                if (t == null) {
                    this.loadDefault();
                }
            }));
            return;
        }
        this.loadDefault();
    }
}
export const self = global.$StartUp ?? (global.$StartUp = new StartUp());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhcnRVcC5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9QYWNrYWdlcy9Uc1Byb2ovc3JjL0xvYWRpbmcvU3RhcnRVcC5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQzdDLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUM5QyxJQUFPLElBQUksR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztBQUNsQyxJQUFPLFlBQVksR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQztBQUNwRSxJQUFPLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO0FBQ2hDLElBQU8sR0FBRyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUM7QUFFcEIsSUFBTyxVQUFVLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUM7QUFDOUMsSUFBTyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUM5QixJQUFPLFNBQVMsR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQztBQUM1QyxJQUFPLE9BQU8sR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztBQUNuQyxJQUFPLE1BQU0sR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQztBQUU5QixJQUFPLFFBQVEsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDO0FBRTlCLE1BQU0sT0FBTyxPQUFRLFNBQVEsUUFBUTtJQUFyQzs7UUFDSSxjQUFTLEdBQVksSUFBSSxDQUFDO0lBbUM5QixDQUFDO0lBL0JHLFdBQVc7UUFDUCxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzNCLEVBQUUsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3JGLENBQUM7SUFHRCxLQUFLLENBQUMsSUFBSTtRQUNOLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU1QixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxpQkFBaUIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDckYsTUFBTSxRQUFRLENBQUMsWUFBWSxDQUFDLGVBQWUsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRXBELE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQztRQUM3QyxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUN4QyxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxnRkFBZ0Y7UUFDM0ksT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLE1BQU0saUJBQWlCLE9BQU8sU0FBUyxLQUFLLEVBQUUsQ0FBQyxDQUFBO1FBQzFFLElBQUksSUFBSSxDQUFDLFNBQVMsSUFBSSxHQUFHLElBQUksS0FBSyxFQUFFLENBQUM7WUFDakMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBQ2xDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUNsQixPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzVCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ2hDLElBQUksQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDO29CQUNaLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDdkIsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDSixPQUFPO1FBQ1gsQ0FBQztRQUNELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUN2QixDQUFDO0NBQ0o7QUFFRCxNQUFNLENBQUMsTUFBTSxJQUFJLEdBQVksTUFBTSxDQUFDLFFBQVEsS0FBZixNQUFNLENBQUMsUUFBUSxHQUFLLElBQUksT0FBTyxFQUFFLENBQUEsQ0FBQyJ9