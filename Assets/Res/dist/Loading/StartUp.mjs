import { StateFsm } from "Common/StateFsm.mjs";
import { 下载更新 } from "Loading/StartUp/下载更新.mjs";
var Time = CS.UnityEngine.Time;
var Addressables = CS.UnityEngine.AddressableAssets.Addressables;
var $promise = puer.$promise;
var Res = CS.Res;
var GameObject = CS.UnityEngine.GameObject;
var $typeof = puer.$typeof;
var Resources = CS.UnityEngine.Resources;
var Setting = CS.Models.Setting;
var JsMain = CS.JsMain;
var UnityApi = CS.UnityApi;
export class StartUp extends StateFsm {
    constructor() {
        super(...arguments);
        this.useRemote = true;
    }
    loadDefault() {
        console.log("Load Backup");
        CS.UnityEngine.Object.Instantiate(Resources.Load("Backup", $typeof(GameObject)));
    }
    async init() {
        this.下载更新 = this.bind(下载更新);
        console.log("init StartUp test2", `Initial Time: ${Time.realtimeSinceStartup.toFixed(2)}`);
        await $promise(Addressables.InitializeAsync().Task);
        const loc = Res.Exists(this.prefab);
        const resVer = Setting.self.ResVersion.Value;
        const baseVer = JsMain.self.baseVersion;
        const isNew = UnityApi.CompareVersion(resVer, baseVer) > 0; //resVer.localeCompare(baseVer, undefined, {numeric: true, sensitivity: 'base'})
        console.log(`ResVersion: ${resVer} baseVersion: ${baseVer} new: ${isNew}`);
        if (this.useRemote && loc && isNew) {
            console.log("StartContent Found");
            this.prefab.Check(x => {
                console.log("check ok");
            });
            await $promise(this.prefab.Inst(t => {
                if (t == null) {
                    this.loadDefault();
                }
            }));
            return;
        }
        this.loadDefault();
    }
}
export const self = global.$StartUp ?? (global.$StartUp = new StartUp());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhcnRVcC5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9QYWNrYWdlcy9Uc1Byb2ovc3JjL0xvYWRpbmcvU3RhcnRVcC5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQzdDLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUM5QyxJQUFPLElBQUksR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztBQUNsQyxJQUFPLFlBQVksR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQztBQUNwRSxJQUFPLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO0FBQ2hDLElBQU8sR0FBRyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUM7QUFFcEIsSUFBTyxVQUFVLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUM7QUFDOUMsSUFBTyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUM5QixJQUFPLFNBQVMsR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQztBQUM1QyxJQUFPLE9BQU8sR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztBQUNuQyxJQUFPLE1BQU0sR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDO0FBRTFCLElBQU8sUUFBUSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUM7QUFFOUIsTUFBTSxPQUFPLE9BQVEsU0FBUSxRQUFRO0lBQXJDOztRQUNJLGNBQVMsR0FBWSxJQUFJLENBQUM7SUFtQzlCLENBQUM7SUEvQkcsV0FBVztRQUNQLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDM0IsRUFBRSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckYsQ0FBQztJQUdELEtBQUssQ0FBQyxJQUFJO1FBQ04sSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEVBQUUsaUJBQWlCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzNGLE1BQU0sUUFBUSxDQUFDLFlBQVksQ0FBQyxlQUFlLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVwRCxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNwQyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUM7UUFDN0MsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDeEMsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsZ0ZBQWdGO1FBQzNJLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxNQUFNLGlCQUFpQixPQUFPLFNBQVMsS0FBSyxFQUFFLENBQUMsQ0FBQTtRQUMxRSxJQUFJLElBQUksQ0FBQyxTQUFTLElBQUksR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFDO1lBQ2pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUNsQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDbEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUM1QixDQUFDLENBQUMsQ0FBQztZQUNILE1BQU0sUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUNoQyxJQUFJLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztvQkFDWixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ3ZCLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ0osT0FBTztRQUNYLENBQUM7UUFDRCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDdkIsQ0FBQztDQUNKO0FBRUQsTUFBTSxDQUFDLE1BQU0sSUFBSSxHQUFZLE1BQU0sQ0FBQyxRQUFRLEtBQWYsTUFBTSxDQUFDLFFBQVEsR0FBSyxJQUFJLE9BQU8sRUFBRSxDQUFBLENBQUMifQ==