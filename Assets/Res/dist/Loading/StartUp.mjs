import { StateFsm } from "Common/StateFsm.mjs";
import { 下载更新 } from "Loading/StartUp/下载更新.mjs";
var Time = CS.UnityEngine.Time;
var Addressables = CS.UnityEngine.AddressableAssets.Addressables;
var $promise = puer.$promise;
var Res = CS.Res;
var GameObject = CS.UnityEngine.GameObject;
var $typeof = puer.$typeof;
var Resources = CS.UnityEngine.Resources;
var Setting = CS.Models.Setting;
var JsMain = CS.App.JsMain;
var UnityApi = CS.UnityApi;
export class StartUp extends StateFsm {
    constructor() {
        super(...arguments);
        this.useRemote = true;
    }
    loadDefault() {
        console.log("Load Backup");
        CS.UnityEngine.Object.Instantiate(Resources.Load("Backup", $typeof(GameObject)));
    }
    async init() {
        this.下载更新 = this.bind(下载更新);
        console.log("init StartUp test2", `Initial Time: ${Time.realtimeSinceStartup.toFixed(2)}`);
        await $promise(Addressables.InitializeAsync().Task);
        const loc = Res.Exists(this.prefab);
        const resVer = Setting.self.ResVersion.Value;
        const baseVer = JsMain.self.baseVersion;
        const isNew = UnityApi.CompareVersion(resVer, baseVer) > 0; //resVer.localeCompare(baseVer, undefined, {numeric: true, sensitivity: 'base'})
        console.log(`ResVersion: ${resVer} baseVersion: ${baseVer} new: ${isNew}`);
        if (this.useRemote && loc && isNew) {
            console.log("StartContent Found");
            this.prefab.Check(x => {
                console.log("check ok");
            });
            await $promise(this.prefab.Inst(t => {
                if (t == null) {
                    this.loadDefault();
                }
            }));
            return;
        }
        this.loadDefault();
    }
}
export const self = global.$StartUp ?? (global.$StartUp = new StartUp());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhcnRVcC5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9QYWNrYWdlcy9Uc1Byb2ovc3JjL0xvYWRpbmcvU3RhcnRVcC5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBQzdDLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUM5QyxJQUFPLElBQUksR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQztBQUNsQyxJQUFPLFlBQVksR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQztBQUNwRSxJQUFPLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO0FBQ2hDLElBQU8sR0FBRyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUM7QUFFcEIsSUFBTyxVQUFVLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUM7QUFDOUMsSUFBTyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUM5QixJQUFPLFNBQVMsR0FBRyxFQUFFLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQztBQUM1QyxJQUFPLE9BQU8sR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztBQUNuQyxJQUFPLE1BQU0sR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQztBQUU5QixJQUFPLFFBQVEsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDO0FBRTlCLE1BQU0sT0FBTyxPQUFRLFNBQVEsUUFBUTtJQUFyQzs7UUFDSSxjQUFTLEdBQVksSUFBSSxDQUFDO0lBbUM5QixDQUFDO0lBL0JHLFdBQVc7UUFDUCxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQzNCLEVBQUUsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3JGLENBQUM7SUFHRCxLQUFLLENBQUMsSUFBSTtRQUNOLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU1QixPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFLGlCQUFpQixJQUFJLENBQUMsb0JBQW9CLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMzRixNQUFNLFFBQVEsQ0FBQyxZQUFZLENBQUMsZUFBZSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFcEQsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDcEMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDO1FBQzdDLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ3hDLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLGdGQUFnRjtRQUMzSSxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsTUFBTSxpQkFBaUIsT0FBTyxTQUFTLEtBQUssRUFBRSxDQUFDLENBQUE7UUFDMUUsSUFBSSxJQUFJLENBQUMsU0FBUyxJQUFJLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztZQUNqQyxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDLENBQUM7WUFDbEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ2xCLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDNUIsQ0FBQyxDQUFDLENBQUM7WUFDSCxNQUFNLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDaEMsSUFBSSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUM7b0JBQ1osSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUN2QixDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNKLE9BQU87UUFDWCxDQUFDO1FBQ0QsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3ZCLENBQUM7Q0FDSjtBQUVELE1BQU0sQ0FBQyxNQUFNLElBQUksR0FBWSxNQUFNLENBQUMsUUFBUSxLQUFmLE1BQU0sQ0FBQyxRQUFRLEdBQUssSUFBSSxPQUFPLEVBQUUsQ0FBQSxDQUFDIn0=