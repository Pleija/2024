import { Utils } from '../../utils.mjs';
export function buildJoinSql(tables, joins) {
    let sql = '';
    const _regs = [];
    function tableName(name) {
        return tables[name].info.name;
    }
    function registered(alias) {
        return _regs.indexOf(alias) > -1;
    }
    function reg(alias) {
        if (registered(alias)) {
            return;
        }
        _regs.push(alias);
    }
    let isLastJoin = false;
    function sqlJoin(alias) {
        sql += ` JOIN  ${Utils.quote(tableName(alias))} AS ${Utils.quote(alias)}`;
        reg(alias);
        isLastJoin = true;
    }
    function sqlOn(join) {
        sql += ` ${isLastJoin ? 'ON' : 'AND'} ${Utils.quote(join.left.alias)}.${Utils.quote(join.left.column)} = ${Utils.quote(join.right.alias)}.${Utils.quote(join.right.column)} `;
    }
    for (const st of joins.sqls) {
        isLastJoin = false;
        if (!_regs.length) {
            sql += ` FROM ${Utils.quote(tableName(st.left.alias))} AS ${Utils.quote(st.left.alias)}`;
            reg(st.left.alias);
            sqlJoin(st.right.alias);
        }
        else {
            if (!registered(st.left.alias)) {
                sqlJoin(st.left.alias);
            }
            if (!registered(st.right.alias)) {
                sqlJoin(st.right.alias);
            }
        }
        sqlOn(st);
    }
    return sql;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3FsLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL1BhY2thZ2VzL1RzUHJvai9zcmMvU3FsaXRlLXRzL2RpYWxlY3RzL2pvaW4vc3FsLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0saUJBQWlCLENBQUE7QUFJdkMsTUFBTSxVQUFVLFlBQVksQ0FBSSxNQUFTLEVBQUUsS0FBaUI7SUFDeEQsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFBO0lBQ1osTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFBO0lBRTFCLFNBQVMsU0FBUyxDQUFDLElBQVk7UUFDM0IsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQTtJQUNqQyxDQUFDO0lBRUQsU0FBUyxVQUFVLENBQUMsS0FBYTtRQUM3QixPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFDcEMsQ0FBQztJQUVELFNBQVMsR0FBRyxDQUFDLEtBQWE7UUFDdEIsSUFBSSxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNwQixPQUFNO1FBQ1YsQ0FBQztRQUVELEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDckIsQ0FBQztJQUVELElBQUksVUFBVSxHQUFHLEtBQUssQ0FBQTtJQUV0QixTQUFTLE9BQU8sQ0FBQyxLQUFhO1FBQzFCLEdBQUcsSUFBSSxVQUFVLEtBQUssQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFBO1FBQ3pFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNWLFVBQVUsR0FBRyxJQUFJLENBQUE7SUFDckIsQ0FBQztJQUVELFNBQVMsS0FBSyxDQUFDLElBQWM7UUFDekIsR0FBRyxJQUFJLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsS0FBSyxDQUMvQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FDbEIsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLEtBQUssQ0FDL0MsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQ25CLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUE7SUFDMUMsQ0FBQztJQUVELEtBQUssTUFBTSxFQUFFLElBQUksS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzFCLFVBQVUsR0FBRyxLQUFLLENBQUE7UUFDbEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNoQixHQUFHLElBQUksU0FBUyxLQUFLLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FDbkUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQ2hCLEVBQUUsQ0FBQTtZQUNILEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBRWxCLE9BQU8sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQzNCLENBQUM7YUFBTSxDQUFDO1lBQ0osSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQzdCLE9BQU8sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQzFCLENBQUM7WUFDRCxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDOUIsT0FBTyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUE7WUFDM0IsQ0FBQztRQUNMLENBQUM7UUFDRCxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUE7SUFDYixDQUFDO0lBRUQsT0FBTyxHQUFHLENBQUE7QUFDZCxDQUFDIn0=