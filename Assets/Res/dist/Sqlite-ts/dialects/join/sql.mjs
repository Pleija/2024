import { Utils } from '../../utils.mjs';
export function buildJoinSql(tables, joins) {
    let sql = '';
    const _regs = [];
    function tableName(name) {
        return tables[name].info.name;
    }
    function registered(alias) {
        return _regs.indexOf(alias) > -1;
    }
    function reg(alias) {
        if (registered(alias)) {
            return;
        }
        _regs.push(alias);
    }
    let isLastJoin = false;
    function sqlJoin(alias) {
        sql += ` JOIN  ${Utils.quote(tableName(alias))} AS ${Utils.quote(alias)}`;
        reg(alias);
        isLastJoin = true;
    }
    function sqlOn(join) {
        sql += ` ${isLastJoin ? 'ON' : 'AND'} ${Utils.quote(join.left.alias)}.${Utils.quote(join.left.column)} = ${Utils.quote(join.right.alias)}.${Utils.quote(join.right.column)} `;
    }
    for (const st of joins.sqls) {
        isLastJoin = false;
        if (!_regs.length) {
            sql += ` FROM ${Utils.quote(tableName(st.left.alias))} AS ${Utils.quote(st.left.alias)}`;
            reg(st.left.alias);
            sqlJoin(st.right.alias);
        }
        else {
            if (!registered(st.left.alias)) {
                sqlJoin(st.left.alias);
            }
            if (!registered(st.right.alias)) {
                sqlJoin(st.right.alias);
            }
        }
        sqlOn(st);
    }
    return sql;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3FsLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL1BhY2thZ2VzL1RzUHJvai9zcmMvU3FsaXRlLXRzL2RpYWxlY3RzL2pvaW4vc3FsLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0saUJBQWlCLENBQUE7QUFJdkMsTUFBTSxVQUFVLFlBQVksQ0FBSSxNQUFTLEVBQUUsS0FBaUI7SUFDMUQsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFBO0lBQ1osTUFBTSxLQUFLLEdBQWEsRUFBRSxDQUFBO0lBRTFCLFNBQVMsU0FBUyxDQUFDLElBQVk7UUFDN0IsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQTtJQUMvQixDQUFDO0lBRUQsU0FBUyxVQUFVLENBQUMsS0FBYTtRQUMvQixPQUFPLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFDbEMsQ0FBQztJQUVELFNBQVMsR0FBRyxDQUFDLEtBQWE7UUFDeEIsSUFBSSxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUN0QixPQUFNO1FBQ1IsQ0FBQztRQUVELEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDbkIsQ0FBQztJQUVELElBQUksVUFBVSxHQUFHLEtBQUssQ0FBQTtJQUV0QixTQUFTLE9BQU8sQ0FBQyxLQUFhO1FBQzVCLEdBQUcsSUFBSSxVQUFVLEtBQUssQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFBO1FBQ3pFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUNWLFVBQVUsR0FBRyxJQUFJLENBQUE7SUFDbkIsQ0FBQztJQUVELFNBQVMsS0FBSyxDQUFDLElBQWM7UUFDM0IsR0FBRyxJQUFJLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsS0FBSyxDQUNqRCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FDaEIsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLEtBQUssQ0FDakQsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQ2pCLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUE7SUFDeEMsQ0FBQztJQUVELEtBQUssTUFBTSxFQUFFLElBQUksS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzVCLFVBQVUsR0FBRyxLQUFLLENBQUE7UUFDbEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNsQixHQUFHLElBQUksU0FBUyxLQUFLLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FDckUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQ2QsRUFBRSxDQUFBO1lBQ0gsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7WUFFbEIsT0FBTyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDekIsQ0FBQzthQUFNLENBQUM7WUFDTixJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDL0IsT0FBTyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7WUFDeEIsQ0FBQztZQUNELElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUNoQyxPQUFPLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUN6QixDQUFDO1FBQ0gsQ0FBQztRQUNELEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUNYLENBQUM7SUFFRCxPQUFPLEdBQUcsQ0FBQTtBQUNaLENBQUMifQ==